"use strict";(self.webpackChunkwasender_chrome_extension=self.webpackChunkwasender_chrome_extension||[]).push([[106],{7459:(Y,f,a)=>{a.r(f),a.d(f,{BroadcastUnsubscriptionPageModule:()=>E});var b=a(6814),g=a(6223),m=a(3427),u=a(5861),_=a(4631),C=a(3964),x=a(8645),v=a(2832),M=a(9360),P=a(8251),t=a(9291),B=a(7122),Z=a(9955),U=a(7825),h=a(1721),y=a(858);const O=["deleteModal"];function A(o,s){if(1&o){const l=t.EpF();t.TgZ(0,"div",28)(1,"button",29),t.NdJ("click",function(){t.CHM(l);const e=t.oxw();return t.KtG(e.confirmBulkDelete())}),t._UZ(2,"i",30),t._uU(3),t.qZA()()}if(2&o){const l=t.oxw();t.xp6(1),t.Q6J("disabled",!l.selectedContacts.length||l.isRemoving),t.xp6(2),t.hij(" Bulk Unblock (",l.selectedContacts.length,") ")}}function S(o,s){if(1&o){const l=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"div",31),t.NdJ("click",function(){const c=t.CHM(l).$implicit,i=t.oxw();return t.KtG(i.singleSelect(c))}),t._UZ(3,"input",32)(4,"label",33),t.qZA()(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td")(10,"button",34),t.NdJ("click",function(){const c=t.CHM(l).$implicit,i=t.oxw();return t.KtG(i.removeFromBlocklist([c.blockNumberId]))}),t.TgZ(11,"span"),t._uU(12,"Unblock"),t.qZA()()()()}if(2&o){const l=s.$implicit,n=t.oxw();t.xp6(3),t.Q6J("id","block-"+l.blockNumberId)("checked",n.selectedMap[l.blockNumberId]),t.xp6(1),t.Q6J("for","block-"+l.blockNumberId),t.xp6(2),t.Oqu(l.blockNumberId),t.xp6(2),t.Oqu(l.blockKeyword),t.xp6(2),t.Q6J("disabled",n.isRemoving)}}function I(o,s){1&o&&t._UZ(0,"div",35)}function D(o,s){1&o&&(t.TgZ(0,"div",36),t._uU(1,"No unsubscriptions found"),t.qZA())}function J(o,s){if(1&o&&(t.ynx(0),t._uU(1," Are you sure you want to remove "),t.TgZ(2,"b"),t._uU(3),t.qZA(),t._uU(4," from unsubuscriptions? "),t.BQk()),2&o){const l=t.oxw();t.xp6(3),t.Oqu(null==l.contactToDelete?null:l.contactToDelete.blockNumberId)}}function N(o,s){if(1&o&&(t.ynx(0),t._uU(1," Are you sure you want to remove "),t.TgZ(2,"b"),t._uU(3),t.qZA(),t._uU(4," contacts from unsubuscriptions? "),t.BQk()),2&o){const l=t.oxw();t.xp6(3),t.Oqu(l.selectedContacts.length)}}function w(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Yes, Delete"),t.qZA())}function Q(o,s){1&o&&t._UZ(0,"span",37)}function F(o,s){1&o&&(t.TgZ(0,"span"),t._uU(1,"Deleting..."),t.qZA())}const R=[{path:"",component:(()=>{var o;class s{constructor(n,e){this.blocklistService=n,this.extDataService=e,this.blockContacts=[],this.skip=0,this.limit=20,this.isLoading=!1,this.allFetched=!1,this.searchTerm="",this.contactToDelete=null,this.selectAll=!1,this.isBulkDelete=!1,this.selectedContacts=[],this.selectedMap={},this.searchSubject=new x.x,this.searchSubject.pipe(function T(o,s=v.z){return(0,M.e)((l,n)=>{let e=null,c=null,i=null;const r=()=>{if(e){e.unsubscribe(),e=null;const d=c;c=null,n.next(d)}};function p(){const d=i+o,k=s.now();if(k<d)return e=this.schedule(void 0,d-k),void n.add(e);r()}l.subscribe((0,P.x)(n,d=>{c=d,i=s.now(),e||(e=s.schedule(p,o),n.add(e))},()=>{r(),n.complete()},void 0,()=>{c=e=null}))})}(400)).subscribe(c=>{console.log("Search term:",c),this.onSearch(c)})}ngOnInit(){var n=this;return(0,u.Z)(function*(){yield n.getBlockContacts()})()}ngOnDestroy(){this.searchSubject.unsubscribe()}getBlockContacts(n=!1){var e=this;return(0,u.Z)(function*(){if(n&&(e.skip=0,e.allFetched=!1,e.blockContacts=[],e.selectedMap={}),!e.isLoading&&!e.allFetched){e.isLoading=!0;try{const c=yield e.blocklistService.getBlocklist(e.searchTerm,String(e.limit),String(e.skip));(!c||c.length<e.limit)&&(e.allFetched=!0),e.blockContacts=[...e.blockContacts,...c],e.skip+=e.limit}catch(c){console.error("Error fetching block contacts:",c)}finally{e.isLoading=!1}}})()}removeFromBlocklist(n){var e=this;return(0,u.Z)(function*(){if(n&&0!==n.length){e.isRemoving=!0;try{const c=e.blockContacts.map((i,r)=>({contact:i,idx:r})).filter(({contact:i})=>n.includes(i.blockNumberId));e.blockContacts=e.blockContacts.filter(i=>!n.includes(i.blockNumberId));try{yield e.blocklistService.removeFromBlocklist(n)}catch(i){throw c.forEach(({contact:r,idx:p})=>{e.blockContacts.splice(p,0,r)}),i}}catch(c){console.error("Error removing from blocklist:",c)}finally{e.isRemoving=!1}}})()}addToBlocklist(n){var e=this;return(0,u.Z)(function*(){if(n&&0!==n.length){e.isAdding=!0;try{const c=n.map(i=>new _.Blockcontact(e.extDataService.currentUser.phoneNumber,i,"",C.nB.getManifestData().version));yield e.blocklistService.addMutlipleBlocklist(c),yield e.getBlockContacts(!0)}catch(c){console.error("Error adding to blocklist:",c)}finally{e.isAdding=!1}}})()}onScroll(){this.getBlockContacts()}onSearchChange(n){this.searchSubject.next(n)}onSearch(n){this.searchTerm=n,this.getBlockContacts(!0)}singleSelect(n){console.log("Toggling selection for contact:",n,this.selectedMap[n.blockNumberId]),this.selectedMap[n.blockNumberId]=!this.selectedMap?.[n.blockNumberId],console.log("Updated selectedMap:",this.selectedMap),this.onContactSelectChange()}onContactSelectChange(){this.selectedContacts=this.blockContacts.filter(n=>!0===this.selectedMap[n.blockNumberId]),this.selectAll=this.selectedContacts.length===this.blockContacts.length&&this.blockContacts.length>0}toggleSelectAll(){this.selectAll=!this.selectAll,this.selectedMap||(this.selectedMap={}),this.blockContacts.forEach(n=>this.selectedMap[n.blockNumberId]=this.selectAll),this.onContactSelectChange()}confirmBulkDelete(){this.isBulkDelete=!0,this.contactToDelete=null}confirmDelete(n){this.isBulkDelete=!1,this.contactToDelete=n}closeDeleteModal(n){this.contactToDelete=null,this.isBulkDelete=!1,this.deleteModalRef.nativeElement&&this.deleteModalRef.nativeElement.querySelector(".close").click()}deleteConfirmed(n){var e=this;return(0,u.Z)(function*(){e.isRemoving=!0;try{if(e.isBulkDelete){const c=e.selectedContacts.map(i=>i.blockNumberId);yield e.removeFromBlocklist(c),c.forEach(i=>delete e.selectedMap[i]),e.selectedContacts=[],e.selectAll=!1}else e.contactToDelete&&(yield e.removeFromBlocklist([e.contactToDelete.blockNumberId]),delete e.selectedMap[e.contactToDelete.blockNumberId]);e.closeDeleteModal(n)}catch(c){console.error("Error deleting contact(s):",c)}finally{e.isRemoving=!1}})()}}return(o=s).\u0275fac=function(n){return new(n||o)(t.Y36(B.I0),t.Y36(Z.a))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-broadcast-unsubscriptions"]],viewQuery:function(n,e){if(1&n&&t.Gf(O,5),2&n){let c;t.iGM(c=t.CRH())&&(e.deleteModalRef=c.first)}},decls:52,vars:21,consts:[[1,"home","px24","py16"],[1,"main","fs12","fw500","mb5"],[1,"fa-kit","fa-unsubscribe","mr3"],[1,"fwn","tul"],["id","search-block",1,"mb10"],["type","text","placeholder","Search by phone number...",1,"form-control",3,"ngModel","ngModelChange"],["class","d-flex a-flex-center py10 j-flex-end","id","bulk-actions",4,"ngIf"],["infiniteScroll","",1,"blocklist-lists",3,"scrollWindow","infiniteScrollDistance","infiniteScrollThrottle","scrolled"],[1,"campaign-table"],[1,"flex","a-flex-center","w-fit-content","cp","mb16",3,"click"],["type","checkbox","id","all-blocks",1,"mt0",3,"checked","click"],["for","all-blocks",1,"fwn","ml0","mb0","pe-none"],[4,"ngFor","ngForOf"],["class","loader theme m-auto m20",4,"ngIf"],["class","text-center mt20",4,"ngIf"],["id","unsubscribe-modal","tabindex","-1","role","dialog","aria-labelledby","modalLabel","aria-hidden","true",1,"modal","fade"],["deleteModal",""],["role","document",1,"modal-dialog"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-content","p0"],[1,"modal-header","py10"],[1,"modal-body","p20"],[4,"ngIf"],[1,"d-flex","j-flex-end","modal-footer"],[1,"btn","btn-danger","d-flex","a-flex-center",3,"disabled","click"],["class","spinner-border spinner-border-sm mr-2","role","status","aria-hidden","true",4,"ngIf"],[1,"btn","btn-secondary","ml8",3,"click"],["id","bulk-actions",1,"d-flex","a-flex-center","py10","j-flex-end"],["data-toggle","modal","data-target","#unsubscribe-modal",1,"btn","btn-danger","fs11",3,"disabled","click"],[1,"fa-kit","fa-trash","mr5"],[1,"flex","a-flex-center","w-fit-content","cp",3,"click"],["type","checkbox",1,"mt0",3,"id","checked"],[1,"fwn","ml0","mb0","pe-none",3,"for"],[1,"action-btn",3,"disabled","click"],[1,"loader","theme","m-auto","m20"],[1,"text-center","mt20"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","mr-2"]],template:function(n,e){if(1&n){const c=t.EpF();t._UZ(0,"app-header"),t.TgZ(1,"div",0)(2,"div",1),t._UZ(3,"i",2),t.TgZ(4,"span"),t._uU(5),t.ALo(6,"jtranslate"),t.qZA(),t.TgZ(7,"i",3),t._uU(8),t.ALo(9,"jtranslate"),t.qZA()(),t.TgZ(10,"div",4)(11,"input",5),t.NdJ("ngModelChange",function(r){return e.searchTerm=r})("ngModelChange",function(r){return e.onSearchChange(r)}),t.qZA()(),t.YNc(12,A,4,2,"div",6),t.TgZ(13,"div",7),t.NdJ("scrolled",function(){return e.onScroll()}),t.TgZ(14,"table",8)(15,"thead")(16,"tr")(17,"th")(18,"div",9),t.NdJ("click",function(){return e.toggleSelectAll()}),t.TgZ(19,"input",10),t.NdJ("click",function(r){return r.stopPropagation()}),t.qZA(),t._UZ(20,"label",11),t.qZA()(),t.TgZ(21,"th"),t._uU(22,"Blocked number"),t.qZA(),t.TgZ(23,"th"),t._uU(24,"Block Keyword"),t.qZA(),t.TgZ(25,"th"),t._uU(26,"Action"),t.qZA()()(),t.TgZ(27,"tbody"),t.YNc(28,S,13,6,"tr",12),t.qZA()(),t.YNc(29,I,1,0,"div",13),t.YNc(30,D,2,0,"div",14),t.qZA()(),t.TgZ(31,"div",15,16)(33,"div",17)(34,"button",18)(35,"span",19),t._uU(36,"\xd7"),t.qZA()(),t.TgZ(37,"div",20)(38,"div",21)(39,"h4")(40,"b"),t._uU(41,"Confirm unblock"),t.qZA()()(),t.TgZ(42,"div",22),t.YNc(43,J,5,1,"ng-container",23),t.YNc(44,N,5,1,"ng-container",23),t.qZA(),t.TgZ(45,"div",24)(46,"button",25),t.NdJ("click",function(){t.CHM(c);const r=t.MAs(32);return t.KtG(e.deleteConfirmed(r))}),t.YNc(47,w,2,0,"span",23),t.YNc(48,Q,1,0,"span",26),t.YNc(49,F,2,0,"span",23),t.qZA(),t.TgZ(50,"button",27),t.NdJ("click",function(){t.CHM(c);const r=t.MAs(32);return t.KtG(e.closeDeleteModal(r))}),t._uU(51,"Cancel"),t.qZA()()()()()}2&n&&(t.xp6(5),t.Oqu(t.lcZ(6,17,"List of peopele who have unsubscribed")),t.xp6(3),t.hij(" ",t.lcZ(9,19,"Unblock to send them messages in the future")," "),t.xp6(3),t.Q6J("ngModel",e.searchTerm),t.xp6(1),t.Q6J("ngIf",e.selectedContacts.length),t.xp6(1),t.Q6J("scrollWindow",!1)("infiniteScrollDistance",2)("infiniteScrollThrottle",50),t.xp6(6),t.Q6J("checked",e.selectAll),t.xp6(9),t.Q6J("ngForOf",e.blockContacts),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!(null!=e.blockContacts&&e.blockContacts.length||e.isLoading)),t.xp6(13),t.Q6J("ngIf",!e.isBulkDelete),t.xp6(1),t.Q6J("ngIf",e.isBulkDelete),t.xp6(2),t.Q6J("disabled",e.isRemoving),t.xp6(1),t.Q6J("ngIf",!e.isRemoving),t.xp6(1),t.Q6J("ngIf",e.isRemoving),t.xp6(1),t.Q6J("ngIf",e.isRemoving))},dependencies:[b.sg,b.O5,g.Fj,g.JJ,g.On,U.G,h.Ry,y.Q],styles:[".home[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:calc(100% - 100px)}.home[_ngcontent-%COMP%]   #bulk-actions[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.08)}.blocklist-lists[_ngcontent-%COMP%]{flex:1;overflow:auto;border:1px solid rgba(0,0,0,.08)}.blocklist-lists[_ngcontent-%COMP%]   .campaign-table[_ngcontent-%COMP%]{width:100%;border-radius:4px!important;outline-offset:-1px}.blocklist-lists[_ngcontent-%COMP%]   .campaign-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#fafbfc}.blocklist-lists[_ngcontent-%COMP%]   .campaign-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;background:#fafbfc;text-align:left;padding:12px 16px;font-size:12px;font-weight:500;color:#00000080;text-transform:none;border-right:1px solid rgba(0,0,0,.04);white-space:nowrap}.blocklist-lists[_ngcontent-%COMP%]   .campaign-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #f0f1f3}.blocklist-lists[_ngcontent-%COMP%]   .campaign-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 16px;font-size:12px;vertical-align:middle}.blocklist-lists[_ngcontent-%COMP%]   .campaign-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:not(:first-child), .blocklist-lists[_ngcontent-%COMP%]   .campaign-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child){text-align:center}.blocklist-lists[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;padding:4px 12px;color:#b42727;border-radius:4px;font-size:13px;transition:background .2s}.blocklist-lists[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]:hover{background:rgba(180,39,39,.08)}.blocklist-lists[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]:disabled{color:#0006;cursor:not-allowed}.loader.theme[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #019F53;border-radius:50%;width:32px;height:32px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.btn[_ngcontent-%COMP%]{padding:6px 16px;border-radius:4px;font-size:14px;border:none;cursor:pointer}.btn.btn-danger[_ngcontent-%COMP%]{background:#B42727;color:#fff}.btn.btn-secondary[_ngcontent-%COMP%]{background:#f3f3f3;color:#333}.btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}"]}),s})()}];let j=(()=>{var o;class s{}return(o=s).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[m.Bz.forChild(R),m.Bz]}),s})();var q=a(7677);let E=(()=>{var o;class s{}return(o=s).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[b.ez,g.u5,j,q.e,h.Rq]}),s})()}}]);